# 2025-11-06 대화/작업 기록

## 주요 작업
- FastAPI 백엔드 초기 골격을 `fastapi_innobeat_coupon/`에 구성하고, requirements/가상환경/`.env` 세팅 완료.
- SQLAlchemy 모델 전체와 Alembic 초기 스키마(`143a4cef797a_create_baseline_schema`) 생성 및 로컬 MariaDB(컨테이너 `mariadb_innobeat_coupon`, 포트 3307)에 적용.
- sendCoupon 화면을 위한 API 뼈대 구현: 상품 조회(`/products`), 캠페인 생성(`/campaigns`), 수신자 업로드(`/campaigns/{id}/recipients/upload`). 수신자 업로드는 CSV 파싱, 전화번호 검증, AES-256-GCM 암호화/해시 저장 로직 포함.
- 데이터 모델에 `phone_hash` 컬럼을 추가하고 Alembic 리비전 `20fed4848552_add_phone_hash_to_recipients`로 반영.
- `httpx`를 추가해 FastAPI TestClient로 `/health/ping` 엔드포인트 동작을 검증.
- ENCRYPTION_KEY 환경 변수를 `.env`/`.env.example`에 반영하고 `app/core/crypto.py`에서 공통 암·복호화/해시 유틸을 제공.

## 현재 상태
- MariaDB 컨테이너: `docker ps` 기준 `mariadb_innobeat_coupon`가 3307 포트에서 기동 중.
- Alembic 헤드는 `20fed4848552`까지 적용됨. 새로운 마이그레이션 추가 시 `.venv/Scripts/alembic upgrade head` 실행 필요.
- FastAPI 앱은 루트에서 `docker compose -f temp/docker-compose-coupon.yml up fastapi_innobeat_coupon` 또는 로컬에서 `uvicorn app.main:app --reload`로 기동 가능.
- SNAP Agent 설치/연동은 미진행. 설치 후 접속 방식/DB 정보 등을 공유 받아야 추후 연동 모듈 작업 가능.

## 향후 작업 메모
1. SNAP Agent 및 COUFUN API 키/엔드포인트 정보를 확보해 연동 서비스/테스트 케이스 작성.
2. sendCoupon CSV 포맷 확정, 유효/무효 레코드 상세 응답 및 UI 요구에 맞춘 에러 코드 정의.
3. sendQuery/sendCs 화면에 필요한 조회/보고/CS API와 백엔드 로직, Redis 큐/스케줄러 구성.
4. 보안 정책에 맞춰 ENCRYPTION_KEY 관리(향후 Vault/rotation)와 로그 마스킹 로직 적용.
5. Docker Compose에서 FastAPI 서비스 build context/requirements 설치 최적화(현재는 수동 venv). CI/CD 파이프라인 설계 필요.

## 향후 대화 시 공유할 것
- 최근 커밋/변경 요약과 미적용 사항(git status).
- SNAP Agent 설치 여부, 접속 정보, 필요한 credential.
- 진행 중인 외부 연동/테스트 결과.
