# 2025-11-12 대화/작업 기록 (session02)

## 진행한 작업
- **로그인 연동**: `index.html`에 실제 `/auth/login` 호출을 붙이고, `js/login.js`에서 로그인 성공 시 `localStorage`에 토큰/사용자/권한을 저장하도록 구현했습니다.
- **사용자 관리 강화**: `adminUsers.html`과 `js/adminUsers.js`에 입력 제약(아이디·비밀번호·이름·이메일·휴대폰 규칙), 비밀번호 표시 토글, ADMIN 권한 체크, API 기본 URL 자동 추론 로직을 추가했습니다.
- **CORS 설정**: FastAPI `app/main.py`에 `CORSMiddleware`를 등록하고 localhost/127.0.0.1 포트 전역을 허용하도록 `allow_origin_regex`를 적용했습니다.
- **API 베이스 지정**: 정적 서버(5500 등)에서 열 때도 도커 FastAPI(8089)로 요청이 가도록 `resolveApiBase()` 로직을 도입하고, 필요 시 `localStorage.apiBaseUrl`로 재정의 가능하도록 했습니다.

## 현재 상태 / 이슈
- 로그인 화면은 API 토큰을 받아 `sendCoupon.html`로 이동하도록 구성되었으나, 브라우저와 API가 서로 다른 포트에 있을 때 CORS 응답 헤더 미반영 이슈로 실제 호출이 계속 막히고 있습니다.
- 사용자 관리 UI의 입력 검증/필터/권한 차단은 동작하지만, 토큰을 정상 발급받지 못한 상태라 실제 사용자 등록까지는 확인하지 못했습니다.

## 다음 단계 제안
1. FastAPI 서버 재시작 후 CORS 응답 헤더가 노출되는지 확인하고, 필요하면 nginx/dockersetting 등 프록시 계층에서도 `Access-Control-Allow-*` 헤더를 전달하도록 조정.
2. `localStorage.apiBaseUrl`에 `http://localhost:8089`를 저장한 뒤 로그인/사용자 등록 플로우를 다시 테스트.
3. 문제가 계속되면 브라우저 Network 탭 캡처를 기반으로 프록시/포워딩 설정을 추가 점검.
